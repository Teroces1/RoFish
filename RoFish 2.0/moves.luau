local module = {}

module.lightPawnAttackL = {
	[1] = 512,
	[2] = 1280,
	[3] = 2560,
	[4] = 5120,
	[5] = 10240,
	[6] = 20480,
	[7] = 40960,
	[8] = 16384,
	[9] = 131072,
	[10] = 327680,
	[11] = 655360,
	[12] = 1310720,
	[13] = 2621440,
	[14] = 5242880,
	[15] = 10485760,
	[16] = 4194304,
	[17] = 33554432,
	[18] = 83886080,
	[19] = 167772160,
	[20] = 335544320,
	[21] = 671088640,
	[22] = 1342177280,
	[23] = 2684354560,
	[24] = 1073741824,
	[25] = 0,
	[26] = 0,
	[27] = 0,
	[28] = 0,
	[29] = 0,
	[30] = 0,
	[31] = 0,
	[32] = 0,
	[33] = 0,
	[34] = 0,
	[35] = 0,
	[36] = 0,
	[37] = 0,
	[38] = 0,
	[39] = 0,
	[40] = 0,
	[41] = 0,
	[42] = 0,
	[43] = 0,
	[44] = 0,
	[45] = 0,
	[46] = 0,
	[47] = 0,
	[48] = 0,
	[49] = 0,
	[50] = 0,
	[51] = 0,
	[52] = 0,
	[53] = 0,
	[54] = 0,
	[55] = 0,
	[56] = 0,
	[57] = 0,
	[58] = 0,
	[59] = 0,
	[60] = 0,
	[61] = 0,
	[62] = 0,
	[63] = 0,
	[64] = 0
}
module.lightPawnAttackU = {
	[1] = 0,
	[2] = 0,
	[3] = 0,
	[4] = 0,
	[5] = 0,
	[6] = 0,
	[7] = 0,
	[8] = 0,
	[9] = 0,
	[10] = 0,
	[11] = 0,
	[12] = 0,
	[13] = 0,
	[14] = 0,
	[15] = 0,
	[16] = 0,
	[17] = 0,
	[18] = 0,
	[19] = 0,
	[20] = 0,
	[21] = 0,
	[22] = 0,
	[23] = 0,
	[24] = 0,
	[25] = 2,
	[26] = 5,
	[27] = 10,
	[28] = 20,
	[29] = 40,
	[30] = 80,
	[31] = 160,
	[32] = 64,
	[33] = 512,
	[34] = 1280,
	[35] = 2560,
	[36] = 5120,
	[37] = 10240,
	[38] = 20480,
	[39] = 40960,
	[40] = 16384,
	[41] = 131072,
	[42] = 327680,
	[43] = 655360,
	[44] = 1310720,
	[45] = 2621440,
	[46] = 5242880,
	[47] = 10485760,
	[48] = 4194304,
	[49] = 33554432,
	[50] = 83886080,
	[51] = 167772160,
	[52] = 335544320,
	[53] = 671088640,
	[54] = 1342177280,
	[55] = 2684354560,
	[56] = 1073741824,
	[57] = 8589934592,
	[58] = 21474836480,
	[59] = 42949672960,
	[60] = 85899345920,
	[61] = 171798691840,
	[62] = 343597383680,
	[63] = 687194767360,
	[64] = 274877906944
}
module.darkPawnAttackL = {
	[1] = 0,
	[2] = 0,
	[3] = 0,
	[4] = 0,
	[5] = 0,
	[6] = 0,
	[7] = 0,
	[8] = 0,
	[9] = 2,
	[10] = 5,
	[11] = 10,
	[12] = 20,
	[13] = 40,
	[14] = 80,
	[15] = 160,
	[16] = 64,
	[17] = 512,
	[18] = 1280,
	[19] = 2560,
	[20] = 5120,
	[21] = 10240,
	[22] = 20480,
	[23] = 40960,
	[24] = 16384,
	[25] = 131072,
	[26] = 327680,
	[27] = 655360,
	[28] = 1310720,
	[29] = 2621440,
	[30] = 5242880,
	[31] = 10485760,
	[32] = 4194304,
	[33] = 33554432,
	[34] = 83886080,
	[35] = 167772160,
	[36] = 335544320,
	[37] = 671088640,
	[38] = 1342177280,
	[39] = 2684354560,
	[40] = 1073741824,
	[41] = 0,
	[42] = 0,
	[43] = 0,
	[44] = 0,
	[45] = 0,
	[46] = 0,
	[47] = 0,
	[48] = 0,
	[49] = 0,
	[50] = 0,
	[51] = 0,
	[52] = 0,
	[53] = 0,
	[54] = 0,
	[55] = 0,
	[56] = 0,
	[57] = 0,
	[58] = 0,
	[59] = 0,
	[60] = 0,
	[61] = 0,
	[62] = 0,
	[63] = 0,
	[64] = 0
}
module.darkPawnAttackU = {
	[1] = 0,
	[2] = 0,
	[3] = 0,
	[4] = 0,
	[5] = 0,
	[6] = 0,
	[7] = 0,
	[8] = 0,
	[9] = 0,
	[10] = 0,
	[11] = 0,
	[12] = 0,
	[13] = 0,
	[14] = 0,
	[15] = 0,
	[16] = 0,
	[17] = 0,
	[18] = 0,
	[19] = 0,
	[20] = 0,
	[21] = 0,
	[22] = 0,
	[23] = 0,
	[24] = 0,
	[25] = 0,
	[26] = 0,
	[27] = 0,
	[28] = 0,
	[29] = 0,
	[30] = 0,
	[31] = 0,
	[32] = 0,
	[33] = 0,
	[34] = 0,
	[35] = 0,
	[36] = 0,
	[37] = 0,
	[38] = 0,
	[39] = 0,
	[40] = 0,
	[41] = 2,
	[42] = 5,
	[43] = 10,
	[44] = 20,
	[45] = 40,
	[46] = 80,
	[47] = 160,
	[48] = 64,
	[49] = 512,
	[50] = 1280,
	[51] = 2560,
	[52] = 5120,
	[53] = 10240,
	[54] = 20480,
	[55] = 40960,
	[56] = 16384,
	[57] = 131072,
	[58] = 327680,
	[59] = 655360,
	[60] = 1310720,
	[61] = 2621440,
	[62] = 5242880,
	[63] = 10485760,
	[64] = 4194304
}

module.lightPawnSingleL = {
	[1] = 256,
	[2] = 512,
	[3] = 1024,
	[4] = 2048,
	[5] = 4096,
	[6] = 8192,
	[7] = 16384,
	[8] = 32768,
	[9] = 65536,
	[10] = 131072,
	[11] = 262144,
	[12] = 524288,
	[13] = 1048576,
	[14] = 2097152,
	[15] = 4194304,
	[16] = 8388608,
	[17] = 16777216,
	[18] = 33554432,
	[19] = 67108864,
	[20] = 134217728,
	[21] = 268435456,
	[22] = 536870912,
	[23] = 1073741824,
	[24] = 2147483648,
	[25] = 0,
	[26] = 0,
	[27] = 0,
	[28] = 0,
	[29] = 0,
	[30] = 0,
	[31] = 0,
	[32] = 0,
	[33] = 0,
	[34] = 0,
	[35] = 0,
	[36] = 0,
	[37] = 0,
	[38] = 0,
	[39] = 0,
	[40] = 0,
	[41] = 0,
	[42] = 0,
	[43] = 0,
	[44] = 0,
	[45] = 0,
	[46] = 0,
	[47] = 0,
	[48] = 0,
	[49] = 0,
	[50] = 0,
	[51] = 0,
	[52] = 0,
	[53] = 0,
	[54] = 0,
	[55] = 0,
	[56] = 0,
	[57] = 0,
	[58] = 0,
	[59] = 0,
	[60] = 0,
	[61] = 0,
	[62] = 0,
	[63] = 0,
	[64] = 0
}
module.lightPawnSingleU = {
	[1] = 0,
	[2] = 0,
	[3] = 0,
	[4] = 0,
	[5] = 0,
	[6] = 0,
	[7] = 0,
	[8] = 0,
	[9] = 0,
	[10] = 0,
	[11] = 0,
	[12] = 0,
	[13] = 0,
	[14] = 0,
	[15] = 0,
	[16] = 0,
	[17] = 0,
	[18] = 0,
	[19] = 0,
	[20] = 0,
	[21] = 0,
	[22] = 0,
	[23] = 0,
	[24] = 0,
	[25] = 1,
	[26] = 2,
	[27] = 4,
	[28] = 8,
	[29] = 16,
	[30] = 32,
	[31] = 64,
	[32] = 128,
	[33] = 256,
	[34] = 512,
	[35] = 1024,
	[36] = 2048,
	[37] = 4096,
	[38] = 8192,
	[39] = 16384,
	[40] = 32768,
	[41] = 65536,
	[42] = 131072,
	[43] = 262144,
	[44] = 524288,
	[45] = 1048576,
	[46] = 2097152,
	[47] = 4194304,
	[48] = 8388608,
	[49] = 16777216,
	[50] = 33554432,
	[51] = 67108864,
	[52] = 134217728,
	[53] = 268435456,
	[54] = 536870912,
	[55] = 1073741824,
	[56] = 2147483648,
	[57] = 0,
	[58] = 0,
	[59] = 0,
	[60] = 0,
	[61] = 0,
	[62] = 0,
	[63] = 0,
	[64] = 0
}
module.darkPawnSingleL = {
	[1] = 0,
	[2] = 0,
	[3] = 0,
	[4] = 0,
	[5] = 0,
	[6] = 0,
	[7] = 0,
	[8] = 0,
	[9] = 1,
	[10] = 2,
	[11] = 4,
	[12] = 8,
	[13] = 16,
	[14] = 32,
	[15] = 64,
	[16] = 128,
	[17] = 256,
	[18] = 512,
	[19] = 1024,
	[20] = 2048,
	[21] = 4096,
	[22] = 8192,
	[23] = 16384,
	[24] = 32768,
	[25] = 65536,
	[26] = 131072,
	[27] = 262144,
	[28] = 524288,
	[29] = 1048576,
	[30] = 2097152,
	[31] = 4194304,
	[32] = 8388608,
	[33] = 16777216,
	[34] = 33554432,
	[35] = 67108864,
	[36] = 134217728,
	[37] = 268435456,
	[38] = 536870912,
	[39] = 1073741824,
	[40] = 2147483648,
	[41] = 0,
	[42] = 0,
	[43] = 0,
	[44] = 0,
	[45] = 0,
	[46] = 0,
	[47] = 0,
	[48] = 0,
	[49] = 0,
	[50] = 0,
	[51] = 0,
	[52] = 0,
	[53] = 0,
	[54] = 0,
	[55] = 0,
	[56] = 0,
	[57] = 0,
	[58] = 0,
	[59] = 0,
	[60] = 0,
	[61] = 0,
	[62] = 0,
	[63] = 0,
	[64] = 0
}
module.darkPawnSingleU = {
	[1] = 0,
	[2] = 0,
	[3] = 0,
	[4] = 0,
	[5] = 0,
	[6] = 0,
	[7] = 0,
	[8] = 0,
	[9] = 0,
	[10] = 0,
	[11] = 0,
	[12] = 0,
	[13] = 0,
	[14] = 0,
	[15] = 0,
	[16] = 0,
	[17] = 0,
	[18] = 0,
	[19] = 0,
	[20] = 0,
	[21] = 0,
	[22] = 0,
	[23] = 0,
	[24] = 0,
	[25] = 0,
	[26] = 0,
	[27] = 0,
	[28] = 0,
	[29] = 0,
	[30] = 0,
	[31] = 0,
	[32] = 0,
	[33] = 0,
	[34] = 0,
	[35] = 0,
	[36] = 0,
	[37] = 0,
	[38] = 0,
	[39] = 0,
	[40] = 0,
	[41] = 1,
	[42] = 2,
	[43] = 4,
	[44] = 8,
	[45] = 16,
	[46] = 32,
	[47] = 64,
	[48] = 128,
	[49] = 256,
	[50] = 512,
	[51] = 1024,
	[52] = 2048,
	[53] = 4096,
	[54] = 8192,
	[55] = 16384,
	[56] = 32768,
	[57] = 65536,
	[58] = 131072,
	[59] = 262144,
	[60] = 524288,
	[61] = 1048576,
	[62] = 2097152,
	[63] = 4194304,
	[64] = 8388608
}


module.knightAttacksL = {
	[1] = 132096,
	[2] = 329728,
	[3] = 659712,
	[4] = 1319424,
	[5] = 2638848,
	[6] = 5277696,
	[7] = 10489856,
	[8] = 4202496,
	[9] = 33816580,
	[10] = 84410376,
	[11] = 168886289,
	[12] = 337772578,
	[13] = 675545156,
	[14] = 1351090312,
	[15] = 2685403152,
	[16] = 1075839008,
	[17] = 67109890,
	[18] = 134219781,
	[19] = 285217034,
	[20] = 570434068,
	[21] = 1140868136,
	[22] = 2281736272,
	[23] = 268439712,
	[24] = 536879168,
	[25] = 262656,
	[26] = 525568,
	[27] = 1116672,
	[28] = 2233344,
	[29] = 4466688,
	[30] = 8933376,
	[31] = 1089536,
	[32] = 2113536,
	[33] = 67239936,
	[34] = 134545408,
	[35] = 285868032,
	[36] = 571736064,
	[37] = 1143472128,
	[38] = 2286944256,
	[39] = 278921216,
	[40] = 541065216,
	[41] = 33554432,
	[42] = 83886080,
	[43] = 167772160,
	[44] = 335544320,
	[45] = 671088640,
	[46] = 1342177280,
	[47] = 2684354560,
	[48] = 1073741824,
	[49] = 0,
	[50] = 0,
	[51] = 0,
	[52] = 0,
	[53] = 0,
	[54] = 0,
	[55] = 0,
	[56] = 0,
	[57] = 0,
	[58] = 0,
	[59] = 0,
	[60] = 0,
	[61] = 0,
	[62] = 0,
	[63] = 0,
	[64] = 0
}
module.knightAttacksU = {
	[1] = 0,
	[2] = 0,
	[3] = 0,
	[4] = 0,
	[5] = 0,
	[6] = 0,
	[7] = 0,
	[8] = 0,
	[9] = 0,
	[10] = 0,
	[11] = 0,
	[12] = 0,
	[13] = 0,
	[14] = 0,
	[15] = 0,
	[16] = 0,
	[17] = 2,
	[18] = 5,
	[19] = 10,
	[20] = 20,
	[21] = 40,
	[22] = 80,
	[23] = 160,
	[24] = 64,
	[25] = 516,
	[26] = 1288,
	[27] = 2577,
	[28] = 5154,
	[29] = 10308,
	[30] = 20616,
	[31] = 40976,
	[32] = 16416,
	[33] = 132096,
	[34] = 329728,
	[35] = 659712,
	[36] = 1319424,
	[37] = 2638848,
	[38] = 5277696,
	[39] = 10489856,
	[40] = 4202496,
	[41] = 33816580,
	[42] = 84410376,
	[43] = 168886289,
	[44] = 337772578,
	[45] = 675545156,
	[46] = 1351090312,
	[47] = 2685403152,
	[48] = 1075839008,
	[49] = 67109890,
	[50] = 134219781,
	[51] = 285217034,
	[52] = 570434068,
	[53] = 1140868136,
	[54] = 2281736272,
	[55] = 268439712,
	[56] = 536879168,
	[57] = 262656,
	[58] = 525568,
	[59] = 1116672,
	[60] = 2233344,
	[61] = 4466688,
	[62] = 8933376,
	[63] = 1089536,
	[64] = 2113536
}

module.kingAttacksL = {
	[1] = 770,
	[2] = 1797,
	[3] = 3594,
	[4] = 7188,
	[5] = 14376,
	[6] = 28752,
	[7] = 57504,
	[8] = 49216,
	[9] = 197123,
	[10] = 460039,
	[11] = 920078,
	[12] = 1840156,
	[13] = 3680312,
	[14] = 7360624,
	[15] = 14721248,
	[16] = 12599488,
	[17] = 50463488,
	[18] = 117769984,
	[19] = 235539968,
	[20] = 471079936,
	[21] = 942159872,
	[22] = 1884319744,
	[23] = 3768639488,
	[24] = 3225468928,
	[25] = 33751040,
	[26] = 84344832,
	[27] = 168689664,
	[28] = 337379328,
	[29] = 674758656,
	[30] = 1349517312,
	[31] = 2699034624,
	[32] = 1086324736,
	[33] = 50331648,
	[34] = 117440512,
	[35] = 234881024,
	[36] = 469762048,
	[37] = 939524096,
	[38] = 1879048192,
	[39] = 3758096384,
	[40] = 3221225472,
	[41] = 0,
	[42] = 0,
	[43] = 0,
	[44] = 0,
	[45] = 0,
	[46] = 0,
	[47] = 0,
	[48] = 0,
	[49] = 0,
	[50] = 0,
	[51] = 0,
	[52] = 0,
	[53] = 0,
	[54] = 0,
	[55] = 0,
	[56] = 0,
	[57] = 0,
	[58] = 0,
	[59] = 0,
	[60] = 0,
	[61] = 0,
	[62] = 0,
	[63] = 0,
	[64] = 0
}
module.kingAttacksU = {
	[1] = 0,
	[2] = 0,
	[3] = 0,
	[4] = 0,
	[5] = 0,
	[6] = 0,
	[7] = 0,
	[8] = 0,
	[9] = 0,
	[10] = 0,
	[11] = 0,
	[12] = 0,
	[13] = 0,
	[14] = 0,
	[15] = 0,
	[16] = 0,
	[17] = 0,
	[18] = 0,
	[19] = 0,
	[20] = 0,
	[21] = 0,
	[22] = 0,
	[23] = 0,
	[24] = 0,
	[25] = 3,
	[26] = 7,
	[27] = 14,
	[28] = 28,
	[29] = 56,
	[30] = 112,
	[31] = 224,
	[32] = 192,
	[33] = 770,
	[34] = 1797,
	[35] = 3594,
	[36] = 7188,
	[37] = 14376,
	[38] = 28752,
	[39] = 57504,
	[40] = 49216,
	[41] = 197123,
	[42] = 460039,
	[43] = 920078,
	[44] = 1840156,
	[45] = 3680312,
	[46] = 7360624,
	[47] = 14721248,
	[48] = 12599488,
	[49] = 50463488,
	[50] = 117769984,
	[51] = 235539968,
	[52] = 471079936,
	[53] = 942159872,
	[54] = 1884319744,
	[55] = 3768639488,
	[56] = 3225468928,
	[57] = 33751040,
	[58] = 84344832,
	[59] = 168689664,
	[60] = 337379328,
	[61] = 674758656,
	[62] = 1349517312,
	[63] = 2699034624,
	[64] = 1086324736
}
module.kingMovesL = {
	[1] = 770,
	[2] = 1797,
	[3] = 3594,
	[4] = 7188,
	[5] = 14444,
	[6] = 28752,
	[7] = 57504,
	[8] = 49216,
	[9] = 197123,
	[10] = 460039,
	[11] = 920078,
	[12] = 1840156,
	[13] = 3680312,
	[14] = 7360624,
	[15] = 14721248,
	[16] = 12599488,
	[17] = 50463488,
	[18] = 117769984,
	[19] = 235539968,
	[20] = 471079936,
	[21] = 942159872,
	[22] = 1884319744,
	[23] = 3768639488,
	[24] = 3225468928,
	[25] = 33751040,
	[26] = 84344832,
	[27] = 168689664,
	[28] = 337379328,
	[29] = 674758656,
	[30] = 1349517312,
	[31] = 2699034624,
	[32] = 1086324736,
	[33] = 50331648,
	[34] = 117440512,
	[35] = 234881024,
	[36] = 469762048,
	[37] = 939524096,
	[38] = 1879048192,
	[39] = 3758096384,
	[40] = 3221225472,
	[41] = 0,
	[42] = 0,
	[43] = 0,
	[44] = 0,
	[45] = 0,
	[46] = 0,
	[47] = 0,
	[48] = 0,
	[49] = 0,
	[50] = 0,
	[51] = 0,
	[52] = 0,
	[53] = 0,
	[54] = 0,
	[55] = 0,
	[56] = 0,
	[57] = 0,
	[58] = 0,
	[59] = 0,
	[60] = 0,
	[61] = 0,
	[62] = 0,
	[63] = 0,
	[64] = 0
}
module.kingMovesU = {
	[1] = 0,
	[2] = 0,
	[3] = 0,
	[4] = 0,
	[5] = 0,
	[6] = 0,
	[7] = 0,
	[8] = 0,
	[9] = 0,
	[10] = 0,
	[11] = 0,
	[12] = 0,
	[13] = 0,
	[14] = 0,
	[15] = 0,
	[16] = 0,
	[17] = 0,
	[18] = 0,
	[19] = 0,
	[20] = 0,
	[21] = 0,
	[22] = 0,
	[23] = 0,
	[24] = 0,
	[25] = 3,
	[26] = 7,
	[27] = 14,
	[28] = 28,
	[29] = 56,
	[30] = 112,
	[31] = 224,
	[32] = 192,
	[33] = 770,
	[34] = 1797,
	[35] = 3594,
	[36] = 7188,
	[37] = 14376,
	[38] = 28752,
	[39] = 57504,
	[40] = 49216,
	[41] = 197123,
	[42] = 460039,
	[43] = 920078,
	[44] = 1840156,
	[45] = 3680312,
	[46] = 7360624,
	[47] = 14721248,
	[48] = 12599488,
	[49] = 50463488,
	[50] = 117769984,
	[51] = 235539968,
	[52] = 471079936,
	[53] = 942159872,
	[54] = 1884319744,
	[55] = 3768639488,
	[56] = 3225468928,
	[57] = 33751040,
	[58] = 84344832,
	[59] = 168689664,
	[60] = 337379328,
	[61] = 1815609344,
	[62] = 1349517312,
	[63] = 2699034624,
	[64] = 1086324736
}


module.castlingRightsMaskL = {
	[1] = 14376,
	[2] = 14376,
	[3] = 14376,
	[4] = 14376,
	[5] = 14380,
	[6] = 14380,
	[7] = 14380,
	[8] = 14380,
	[9] = 14440,
	[10] = 14440,
	[11] = 14440,
	[12] = 14440,
	[13] = 14444,
	[14] = 14444,
	[15] = 14444,
	[16] = 14444,
}

module.castlingRightsMaskU = {
	[1] = 674758656,
	[2] = 741867520,
	[3] = 1748500480,
	[4] = 1815609344,
	[5] = 674758656,
	[6] = 741867520,
	[7] = 1748500480,
	[8] = 1815609344,
	[9] = 674758656,
	[10] = 741867520,
	[11] = 1748500480,
	[12] = 1815609344,
	[13] = 674758656,
	[14] = 741867520,
	[15] = 1748500480,
	[16] = 1815609344,
}

module.castlingRightsUpdater = {
	[1]  = 0b1011,
	[2]  = 0b1111,
	[3]  = 0b1111,
	[4]  = 0b1111,
	[5]  = 0b0011,
	[6]  = 0b1111,
	[7]  = 0b1111,
	[8]  = 0b0111,
	[9]  = 0b1111,
	[10] = 0b1111,
	[11] = 0b1111,
	[12] = 0b1111,
	[13] = 0b1111,
	[14] = 0b1111,
	[15] = 0b1111,
	[16] = 0b1111,
	[17] = 0b1111,
	[18] = 0b1111,
	[19] = 0b1111,
	[20] = 0b1111,
	[21] = 0b1111,
	[22] = 0b1111,
	[23] = 0b1111,
	[24] = 0b1111,
	[25] = 0b1111,
	[26] = 0b1111,
	[27] = 0b1111,
	[28] = 0b1111,
	[29] = 0b1111,
	[30] = 0b1111,
	[31] = 0b1111,
	[32] = 0b1111,
	[33] = 0b1111,
	[34] = 0b1111,
	[35] = 0b1111,
	[36] = 0b1111,
	[37] = 0b1111,
	[38] = 0b1111,
	[39] = 0b1111,
	[40] = 0b1111,
	[41] = 0b1111,
	[42] = 0b1111,
	[43] = 0b1111,
	[44] = 0b1111,
	[45] = 0b1111,
	[46] = 0b1111,
	[47] = 0b1111,
	[48] = 0b1111,
	[49] = 0b1111,
	[50] = 0b1111,
	[51] = 0b1111,
	[52] = 0b1111,
	[53] = 0b1111,
	[54] = 0b1111,
	[55] = 0b1111,
	[56] = 0b1111,
	[57] = 0b1110,
	[58] = 0b1111,
	[59] = 0b1111,
	[60] = 0b1111,
	[61] = 0b1100,
	[62] = 0b1111,
	[63] = 0b1111,
	[64] = 0b1101
}


function getBB(pos)
	return bit32.lshift(1,pos), bit32.lshift(1,pos-32)
end

function getBB2(r,f)
	if r < 0 or r >= 8 then return 0,0 end
	if f < 0 or f >= 8 then return 0,0 end

	return getBB(r*8 + f)
end

function addMove(r,f,l,u)
	local a,b = getBB2(r,f)
	return a+l, b+u
end

function spreadBits(maskL, maskU, data)
	local resultL, resultU = 0, 0
	local bitPos = 0
	for i = 0, 31 do
		if bit32.band(maskL, bit32.lshift(1, i)) ~= 0 then
			if bit32.band(data, bit32.lshift(1, bitPos)) ~= 0 then
				resultL = bit32.bor(resultL, bit32.lshift(1, i))
			end
			bitPos = bitPos + 1
		end
	end
	for i = 0, 31 do
		if bit32.band(maskU, bit32.lshift(1, i)) ~= 0 then
			if bit32.band(data, bit32.lshift(1, bitPos)) ~= 0 then
				resultU = bit32.bor(resultU, bit32.lshift(1, i))
			end
			bitPos = bitPos + 1
		end
	end
	return resultL, resultU
end

function generateMask(dirFile, dirRank, startFile, startRank, currentLower, currentUpper)
	local l, u = 0, 0
	local r, f = startRank + dirRank, startFile + dirFile

	while (r > 0 or (startRank == 0 and dirRank == 0)) and (r < 7 or (startRank == 7 and dirRank == 0)) and (f > 0 or (startFile == 0 and dirFile == 0)) and (f < 7 or (startFile == 7 and dirFile == 0)) do
		l, u = addMove(r, f, l, u)
		r = r + dirRank
		f = f + dirFile
	end

	-- Mask generation complete; return the bitboards
	return bit32.bor(currentLower, l), bit32.bor(currentUpper, u)
end

-- Function to generate moves considering blockers
function generateMoves(dirFile, dirRank, startFile, startRank, blockerLower, blockerUpper, currentLower, currentUpper)
	local l, u = 0, 0
	local r, f = startRank + dirRank, startFile + dirFile

	while r >= 0 and r < 8 and f >= 0 and f < 8 do
		local moveLower, moveUpper = getBB2(r, f)

		-- Add move to the bitboards
		l, u = addMove(r, f, l, u)

		-- Check for blockers; stop if a blocker is encountered
		if bit32.band(moveLower, blockerLower) ~= 0 or bit32.band(moveUpper, blockerUpper) ~= 0 then
			break
		end

		r = r + dirRank
		f = f + dirFile
	end

	-- Moves generation complete; return the bitboards
	return bit32.bor(currentLower, l), bit32.bor(currentUpper, u)
end

function bishopEncoding(blockersL, blockersU)
	return blockersL + blockersU//2
end

function rookEncoding(blockersL, blockersU)
	return blockersL * 31 + blockersU*3
end



function getMove(pos, directions, encoding)
	local r,f = pos//8, pos%8

	local maskL, maskU = 0,0
	
	for _, dir in directions do
		maskL, maskU = generateMask(dir[1], dir[2], f, r, maskL, maskU)
	end


	local blockerBits = 0
	for i = 0, 63 do
		if bit32.band(maskL, bit32.lshift(1, i)) ~= 0 or bit32.band(maskU, bit32.lshift(1, i-32)) ~= 0 then
			blockerBits = blockerBits + 1
		end
	end
	--print("pos "..pos..", total "..blockerBits.." bits : mask: ", maskL, maskU)

	local resL, resU = {}, {}

	for blockerData = 0, bit32.lshift(1, blockerBits) - 1 do
		local blockerLower, blockerUpper = spreadBits(maskL, maskU, blockerData)

		--print("combination "..blockerData.." | ",blockerLower, blockerUpper)

		-- Generate moves for each direction
		local movesL, movesU = 0,0
		for _, dir in directions do
			movesL, movesU = generateMoves(dir[1],dir[2], f, r, blockerLower, blockerUpper, movesL, movesU)
		end
		
		local index = encoding(blockerLower, blockerUpper)

		if resL[index] ~= nil then
			warn("did not work: ", index, " | ", blockerLower, blockerUpper)
		end
		resL[index] = movesL
		resU[index] = movesU
	end

	return maskL, maskU, resL, resU
end


local l,u,ml,mu = {}, {}, {}, {}

for i = 0,63 do
	ml[i+1], mu[i+1], l[i+1], u[i+1] = getMove(i, {{1,1}, {1,-1}, {-1,1}, {-1,-1}}, bishopEncoding)
end

module.bishopMaskL = ml
module.bishopMaskU = mu
module.bishopMovesL = l
module.bishopMovesU = u


local l,u,ml,mu = {}, {}, {}, {}
for i = 0,63 do
	ml[i+1], mu[i+1], l[i+1], u[i+1] = getMove(i, {{1,0}, {-1,0}, {0,1}, {0,-1}}, rookEncoding)
end

module.rookMaskL = ml
module.rookMaskU = mu
module.rookMovesL = l
module.rookMovesU = u


module.endGameKingEval = table.create(4096,0)

for i = 0,63 do
	local opponentFile = i%8
	local opponentRank = i//8
	for j = 0,63 do
		local kingFile = j%8
		local kingRank = j//8
		local distanceFile = math.abs(kingFile-opponentFile)
		local distanceRank = math.abs(kingRank-opponentRank)

		local distanceFromCenterFile = math.max(3-opponentFile,opponentFile-4)
		local distanceFromCenterRank = math.max(3-opponentRank,opponentRank-4)

		module.endGameKingEval[i + j*64 + 1] = 4* (14-(distanceFile+distanceRank)) + 10*(distanceFromCenterFile + distanceFromCenterRank)
	end
end

return module
